# Домашнее задание к занятию "Резервное копирование баз данных" - Лебедев Антон

---

### Задание 1. Резервное копирование

### Кейс
*Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования.* 

*Необходимо описать, какие варианты резервного копирования подходят в случаях:* 

*1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.*

Теоретически возможно ежедневно делать полное резервное копирование, но обычная схема с еженедельным полным копированием и ежедневным дифферециальным видится более логичной.

*1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.*

Ежечасные инкрементальные копии (в таком случае копируется обычно не сама база, а журнал транзакций).

*1.3. * Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.*

Такое возможно при использовании репликации, но всегда надо помнить, что репликация помогает лишь в случае отказа самого сервера. Если данные будут повреждены без нарушения работы сервера (некорректная команда или злой умысел, например), то это повреждение отреплицируется быстрее, чем будет обнаружено, и реплика также будет содержать повреждённые данные. Поэтому репликация может быть лишь дополнением резервному копированию, но никак не заменой.

---

### Задание 2. PostgreSQL

*2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).*
```
pg_dump zabbix > /tmp/zabbix.dump
pg_restore -d zabbix /tmp/zabbix.bak
```
*2.1. * Возможно ли автоматизировать этот процесс? Если да, то как?*

Да, самый логичный способ - через cron.

---

### Задание 3. MySQL

*3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL.* 

Инкрементальное резервное копирование одной командой в "чистом" MySQL невозможно - для этого нужно несколько команд:
 - Запуск нового журнала транзакций (FLUSH BINARY LOGS),
 - Копирование готовых двоичных файлов журнала,
 - Удаление ненужных двоичных файлов журнала (PURGE BINARY LOGS).

Либо можно использовать сторонние пакеты (например, XtraBackup или mysql-incremental), которые, по сути, делают то же самое за пользователя.

*3.1. * В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?*

Нельзя сравнивать репликацию и резервное копирование. Репликация повышает отказоустойчивость лишь "движка" базы данных, тогда как резервное копирование сохраняет копии данных за разные промежутки времени. При повреждении данных в результате корректного выполнения неверной команды механизм репликации моментально повредит данные во всех репликах, и восстановить их будет невозможно. Базу данных, для которой репликация нужна, а резервное копирование - нет, по идее придумать можно (какая-нибудь хитрая БД-кэш, которую в случае сбоя проще построить заново по текущим запросам и "источнику", чем восстанавливать), но и в таком случае сравнивать резервное копирование и репликацию неуместно - у них разные задачи.

---


