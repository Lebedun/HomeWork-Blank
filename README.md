# Домашнее задание к занятию "MySQL" - Лебедев Антон

## Задача 1

*Используя Docker, поднимите инстанс MySQL (версию 8). Данные БД сохраните в volume.*

*Изучите [бэкап БД](https://github.com/netology-code/virt-homeworks/tree/virt-11/06-db-03-mysql/test_data) и восстановитесь из него.*

*Перейдите в управляющую консоль `mysql` внутри контейнера.*

*Используя команду `\h`, получите список управляющих команд.*

*Найдите команду для выдачи статуса БД и **приведите в ответе** из её вывода версию сервера БД.*

*Подключитесь к восстановленной БД и получите список таблиц из этой БД.*

***Приведите в ответе** количество записей с `price` > 300.*

*В следующих заданиях мы будем продолжать работу с этим контейнером.*

---

```
mysql> \s
--------------
mysql  Ver 8.0.32 for Linux on x86_64 (MySQL Community Server - GPL)
```

```
mysql> select count(1) from orders where price>300;
+----------+
| count(1) |
+----------+
|        1 |
+----------+
1 row in set (0.00 sec)
```

## Задача 2

*Создайте пользователя test в БД c паролем test-pass, используя:*

- *плагин авторизации mysql_native_password*
- *срок истечения пароля — 180 дней* 
- *количество попыток авторизации — 3* 
- *максимальное количество запросов в час — 100*
- *аттрибуты пользователя:*
    - *Фамилия "Pretty"*
    - *Имя "James".*

*Предоставьте привелегии пользователю `test` на операции SELECT базы `test_db`.*
    
*Используя таблицу INFORMATION_SCHEMA.USER_ATTRIBUTES, получите данные по пользователю `test` и **приведите в ответе к задаче**.*

---

Вообще в указанной таблице отображаются лишь добавленные произвольные атрибуты пользователя (имя и фамилия), остальное надо смотреть в mysql.user (а привилегии уровня базы данных - в mysql.db), но раз задание именно таково, выполняю:

```
mysql> select * from  INFORMATION_SCHEMA.USER_ATTRIBUTES where user = 'test';
+------+-----------+---------------------------------------+
| USER | HOST      | ATTRIBUTE                             |
+------+-----------+---------------------------------------+
| test | localhost | {"fname": "James", "lname": "Pretty"} |
+------+-----------+---------------------------------------+
1 row in set (0.00 sec)
```

В процессе выполнения обнаружилась премерзкая особенность mysql не запоминать строку ввода, если в ней упоминалась комбинация букв password, даже когда сам пароль не задавался. 


## Задача 3

*Установите профилирование `SET profiling = 1`.*
*Изучите вывод профилирования команд `SHOW PROFILES;`.*

*Исследуйте, какой `engine` используется в таблице БД `test_db` и **приведите в ответе**.*

*Измените `engine` и **приведите время выполнения и запрос на изменения из профайлера в ответе**:*
- *на `MyISAM`,*
- *на `InnoDB`.*

---

```
mysql> select table_name, engine from information_schema.tables where table_name='orders';
+------------+--------+
| TABLE_NAME | ENGINE |
+------------+--------+
| orders     | InnoDB |
+------------+--------+
1 row in set (0.00 sec)
```

Вывод профайлера. Первая строка (запрос номер 6) - на движке InnoDB, вторая строка - на движке MyISAM. Учитывая, что в таблице всего 5 строк, ничего поменяться существенно и не могло.
```
+----------+------------+------------------------------------------------------------------------------------+
| Query_ID | Duration   | Query                                                                              |
+----------+------------+------------------------------------------------------------------------------------+
|        6 | 0.00031275 | select * from orders                                                               |
+----------+------------+------------------------------------------------------------------------------------+
|       10 | 0.00030475 | select * from orders                                                               |
+----------+------------+------------------------------------------------------------------------------------+
```

## Задача 4 

*Изучите файл `my.cnf` в директории /etc/mysql.*

*Измените его согласно ТЗ (движок InnoDB):*

- *скорость IO важнее сохранности данных;*
- *нужна компрессия таблиц для экономии места на диске;*
- *размер буффера с незакомиченными транзакциями 1 Мб;*
- *буффер кеширования 30% от ОЗУ;*
- *размер файла логов операций 100 Мб.*

*Приведите в ответе изменённый файл `my.cnf`.*

---

Файл лежал прямо в /etc, но это не важно. Для краткости оставляю лишь упомянутые параметры.

```
# Cкорость IO важнее сохранности таблиц:
innodb_flush_log_at_trx_commit = 0
#либо innodb_flush_log_at_trx_commit = 2, это менее "опасный" режим, но и чуть более медленный.

# Нужна компрессия таблиц для экономии места на диске:
innodb_file_format=Barracuda

# Размер буфера с незакомиченными транзакциями 1 Мб:
innodb_log_buffer_size = 1M

# Буфер кеширования 30% от ОЗУ:
innodb_buffer_pool_size = [выставить 30% от оперативной памяти вручную, автоматически он не умеет]

# Размер файла логов операций 100 Мб:
innodb_log_file_size = 100M
```

