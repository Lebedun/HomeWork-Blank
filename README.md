# Домашнее задание к занятию "Репликация и масштабирование. Часть 2" - Лебедев Антон

### Задание 1

*Опишите основные преимущества использования масштабирования методами:*
*Дайте ответ в свободной форме.*

*- активный master-сервер и пассивный репликационный slave-сервер;*

Максимально простая конфигурация.

*- master-сервер и несколько slave-серверов;*

Чуть сложнее предыдущего пункта, но больше скорость чтения (нагрузка может быть поделена между slave-серверами), плюс slave-сервера можно разнести "географически" для оптимизации скорости доступа клиентов.

*- активный сервер со специальным механизмом репликации — distributed replicated block device (DRBD);*

Более универсальное решение - реплицировать можно любую "информационную сущность" представимую в виде блочного устройства, а не только базу данных.

*- SAN-кластер.*

Как постоянный пользователь подобного решения от IBM, основным его преимуществом именно SAN я считаю возможность создать огромный уровень устойчивости ко всевозможным сбоям (при условии корректной настройки оборудования). Падает канал связи между устройствами ? Фигня вопрос, устройство поддерживало два независимых канала (и мы их настроили). Умер контроллер на одном из устройств ? Так оно было оснащено двумя независимыми "управляющими узлами", нагрузку мгновенно подхватил второй контроллер, пользователи ничего не заметили, сдохший контроллер прямо "нагорячую" перезагрузили или заменили на новый. Умер диск ? Сработала горячая замена, рейд пересобрался, осталось заменить сбойный диск. Умерло устройство целиком ? Активная система репликации до последнего поддерживала актуальные копии критически важных разделов с данными, нам остаётся только подцепить vmdkшки к виртуальным машинам на другом виртуализаторе (а то и виртуалки-копии автоматически стартуют при потере оригиналов). Но, а). дорого и б). со всем этим добром надо уметь обращаться.

---

### Задание 2

*Разработайте план для выполнения горизонтального и вертикального шаринга базы данных. База данных состоит из трёх таблиц:* 

*- пользователи,* 
*- книги,* 
*- магазины (столбцы произвольно).* 

*Опишите принципы построения системы и их разграничение или разбивку между базами данных.*
*Пришлите блоксхему, где и что будет располагаться. Опишите, в каких режимах будут работать сервера.* 

Ниже (после разделителя) приведён наиболее логичный план шардинга базы данных, но поскольку задание уже дважды не было принято - по требованию проверяющего делаю отдельно планы вертикального и горизонтального шардинга. В реальной жизни такая операция бессмысленна, но...

Вертикальный шардинг:

Таблицу "пользователи" выносим на один сервер, Таблицы "Книги" и "Магазины" - на другой. Работающее с БД приложение должно знать, за какими данными на какой из серверов обращаться.

![Screenshot_2](https://github.com/Lebedun/HomeWork-Blank/blob/12-07/img/Screenshot_2.jpg)

Горизонтальный шардинг:

Таблицы "Книги" и "Пользователи" делим по нескольким серверам по принципу принадлежности к магазину. Таблица "Магазины" хранится на центральном сервере. Работающее с БД приложение может само знать, к какой из БД обращаться, либо каждый раз получать эту информацию с центрального сервера (необходимая информация может храниться в таблице stores).

![Screenshot_3](https://github.com/Lebedun/HomeWork-Blank/blob/12-07/img/Screenshot_3.jpg)

Никакой репликации (был допвопрос от проверяющего) ни в одной из схем не предусматривается - задача о шардинге, а не о репликации. 

---
---
---

Насколько я понял задание, мы рассматриваем книжный магазин с большим числом филиалов. В этом случае логично иметь следующую конфигурацию:

1. Центральная база данных содержит полную информацию.
2. В каждом филиале содержится часть таблицы "пользователи" и часть таблицы "книги", которая относится к этому филиалу. Таким образом, для большинства типичных операций достаточно быстрого обращения только к локальной базе данных (в которой есть всё нужное и ничего лишнего). Таблица "магазины" может содержаться только на центральном сервере - в филиалах она не нужна.
3. Необходима возможность запросов из филиалов к центральной БД (например, покупатель, не найдя нужной книги в конкретном филиале, может спросить, где она есть в наличии).
    
Таким образом, у нас получается некое сочетание вертикального и горизонтального шардинга.

![Screenshot_1](https://github.com/Lebedun/HomeWork-Blank/blob/12-07/img/Screenshot_1.jpg)
