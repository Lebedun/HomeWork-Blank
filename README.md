# Домашнее задание к занятию "Disaster Recovery" - Лебедев Антон

### Задание 1

*В чём разница между DRaaS, BaaS, Active-Active, Active-Passive?*

DRaaS предоставляет облачную среду для работы в случае аварии (облачные ВМ, хранилища данных и т.п.).

BaaS специализируется на облачном хранении только резервных копий, куда их разворачивать - забота клиента.

Active-Active - концепция отказоустойчивого кластера, которая возможна, если в нём есть некоторое число однотипных узлов. Нагрузку с отказавшего узла берут на себя его "коллеги".

Active-Passive - концепция отказоустойчивого кластера, когда мы имеем возможность держать наготове полную работоспособную копию каждого узла, которая вступает в работу в случае его отказа.

Кстати, сейчас мы в компании в какой-то мере одновременно используем все четыре упомянутых подхода. У нас есть три облачных ВМ для "горячей" замены трёх наших железных серверов 1С (ни разу реально не пригождались, но учения мы проводили), в облаке же хранятся резервные копии баз данных (помимо локальных копий и копий на "хранилище судного дня", по принципу Active-Active работают АРМ операторов и сервера RDP, по принципу Active-Passive устроены некоторые хранилища данных (при отказе одного из них его функцию на себя возьмёт второе, в которое непрерывно реплицируется содержимое первого).

---

### Задание 2

Компании нужно составить план восстановления в случае Disaster recovery. Сервер состоит из системного диска и диска с данными. 
Требуется копировать два логических диска на один физический: 
- системный диск (C:) (20 гигабайт);
- диск с данными (D:) (256 гигабайт). 

В требованиях говорится: 
- данные критичны в течение 24 часов после аварии;
- сеть критична к большим потокам данных в рабочее время;
- рабочее время с 9.00 до 18.00, пять дней (понедельник – пятница);
- план резервирования должен быть реализован для диска C и для диска D. В случае Linux-систем /dev/sda1, /dev/sda4 или /dev/sdb1-данные;
- считается, что для этой задачи может быть: 1) поставлен второй сервер или 2) выбрана облачная инфраструктура с определённой услугой;
- компания готова платить за 10 терабайт места как в одном, так и в другом случае.
 
*Приведите ответ в форме плана востановления с выбранным механизмом и получившейся топологией.*

Предполагаю, что второй сервер не может зеркалировать первый (по производительности, например), и служит только файловым хранлищем. В таком случае выбор между облаком и вторым сервером будет в основном определяться возможностью иметь достаточно быстрый канал к облаку (причём критичным будет время получения данных из облака, так как заливать бэкап туда мы спокойно можем всю ночь, а вот получить его назад в случае отказа нужно будет быстро), и соотношением между стоимостью эксплуатации сервера и облака. Добавлю также, что в случае бэкапа на отдельном сервере в идеале он должен стоять в другом ДЦ, так как в случае хоть и редкого, но всё же теоретически возможного отказа типа "катастрофический пожар в датацентре" мы потеряем разом и основной сервер, и сервер с бэкапами. При этом нам нужен быстрый канал связи между датацентрами (что на практике вполне возможно).

В обоих случаях (бэкап на отдельный сервер или в облако) должно быть настроено резервное копирование отдельно системного диска и диска с данными. 

Для системного диска достаточно делать полную копию раз в неделю (предполагается, что там стоит только ПО, и обычные изменения - это установка обновлений, которые выходят нечасто, и устанавливаются несложно), на выходных, достаточно хранить несколько последних копий (вряд ли возможна ситуация, когда нам срочно потребуется конфигурация ПО полугодовой давности, в крайнем случае нужную версию ПО можно скачать у поставщика). В случае установки критичных обновлений, после которых мы можем ожидать проблем, перед ними можно сделать внеочередной бэкап, в крайнем случае даже в рабочее время (20Гб - не так много для современной сети). 

Для диска с данными нужны еженедельно делать полный бэкап в ночь с пятницы на субботу (чтобы в случае проблем с его созданием у нас была возможность отреагировать до следующего рабочего дня) и дифференциальный бэкап в другие ночи. Глубина хранения, если у нас есть 10 Тб, может составить более полугода (в месяц расходуется порядка терабайта, часть диска лучше держать свободной на всякий случай), однако на практике это обычно не нужно - часто хранят ежедневные копии за последние 30 дней и отдельно полную копию на первое число каждого месяца за полседний год.

При потере данных можно восстановить их полностью (или потерянную часть их) прямо "на ходу", не выключая сервер (если во время восстановления утраченной части данных возможна работа с уцелевшими). При потере только системного диска, без потери данных (например, криво встало обновление) он восстановится быстро, так как размер бэкапа намного меньше.

Отдельно стоит не забывать про регулярную процедуру тестирования резервных копий на корректность.
